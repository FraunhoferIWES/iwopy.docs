

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="">
    
    
      
        <title>Electrostatic potential minimization - iwopy 0.3.1 documentation</title>
      
    
    
      
        
        
          
          
          <meta name="theme-color" content="#009485">
        
      
      

    
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="../_static/sphinx_immaterial_theme.3625f807144f53acf.min.css?v=fbfc4466" />
        <link rel="stylesheet" type="text/css" href="../_static/nbsphinx-code-cells.css?v=2aa19091" />
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="teal" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="iwopy 0.3.1 documentation" class="md-header__button md-logo" aria-label="iwopy 0.3.1 documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            iwopy 0.3.1 documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Electrostatic potential minimization
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/FraunhoferIWES/iwopy" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    iwopy
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="iwopy 0.3.1 documentation" class="md-nav__button md-logo" aria-label="iwopy 0.3.1 documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    iwopy 0.3.1 documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/FraunhoferIWES/iwopy" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    iwopy
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../citation.html" class="md-nav__link">
        <span title="/citation.md (reference label)" class="md-ellipsis">Citation</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../installation.html" class="md-nav__link">
        <span title="/installation.md (reference label)" class="md-ellipsis">Installation</span>
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../examples.html"><span title="/examples.rst (reference label)" class="md-ellipsis">Examples</span></a>
          
            <label for="__nav_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Examples" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          <span title="/examples.rst (reference label)" class="md-ellipsis">Examples</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="simple_function.html" class="md-nav__link">
        <span title="/notebooks/simple_function.ipynb (reference label)" class="md-ellipsis">Simple function minimization</span>
      </a>
    </li>
  

            
          
            
              
  
  
    
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      <a href="#" class="md-nav__link md-nav__link--active">
        <span title="/notebooks/electrostatics.ipynb (reference label)" class="md-ellipsis">Electrostatic potential minimization</span>
      </a>
      
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="multi_obj_chain.html" class="md-nav__link">
        <span title="/notebooks/multi_obj_chain.ipynb (reference label)" class="md-ellipsis">Multi objective geometric chain</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="mixed.html" class="md-nav__link">
        <span title="/notebooks/mixed.ipynb (reference label)" class="md-ellipsis">Mixed problems</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../wind_farm_layout.html" class="md-nav__link">
        <span title="/wind_farm_layout.md (reference label)" class="md-ellipsis">Wind farm layout optimization</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../api.html" class="md-nav__link">
        <span title="/api.rst (reference label)" class="md-ellipsis">API</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../testing.html" class="md-nav__link">
        <span title="/testing.md (reference label)" class="md-ellipsis">Testing</span>
      </a>
    </li>
  

    
      
      
      

  
  
  
  
    <li class="md-nav__item">
      <a href="../CHANGELOG.html" class="md-nav__link">
        <span title="/changelog.md (reference label)" class="md-ellipsis">History</span>
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary">
  
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset" role="main">
                  


<script src='http://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js'></script>
<script>require=requirejs;</script><h1 id="Electrostatic-potential-minimization">Electrostatic potential minimization<a class="headerlink" href="#Electrostatic-potential-minimization" title="Link to this heading">¶</a></h1>
<p>The main purpose of <code class="docutils literal notranslate"><span class="pre">iwopy</span></code> is to be helpful when attacking more complicated optimization tasks than the minimization of simple analytical functions. As an example, we consider the minimization of an inverse distance type potential for a fully coupled system of <span class="math notranslate nohighlight">\(N\)</span> particles in two dimensions. We can imagine such a system to be composed of <span class="math notranslate nohighlight">\(N\)</span> individual point charges, each of them carrying the same electric unit charge. The potential that we want to minimize is then represented by</p>
<div class="math notranslate nohighlight">
\[\begin{split}V = \sum_{i\neq j} \frac 1 {|\mathrm r_i - \mathrm r_j|} \ , \quad \text{where} \quad \mathrm r_i = \left( \begin{array}{c} x_i \\ y_i \end{array} \right)\end{split}\]</div>
<p>denotes the two dimensional position vector of charge <span class="math notranslate nohighlight">\(i\)</span> and the sum is over all unequal index pairs. This potential favours large distances between charges, hence we need to constrain them to a certain area for a meaningful solution. We confine them to a circle of radius <span class="math notranslate nohighlight">\(R\)</span> by imposing <span class="math notranslate nohighlight">\(N\)</span> constraints,</p>
<div class="math notranslate nohighlight">
\[|\mathrm r_i| \leq R \ , \quad \text{for all} \quad i = 0 \ldots N-1 \ .\]</div>
<p>These are the required imports for this example:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>In [1]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">iwopy</span> <span class="kn">import</span> <span class="n">Problem</span><span class="p">,</span> <span class="n">Objective</span><span class="p">,</span> <span class="n">Constraint</span>
<span class="kn">from</span> <span class="nn">iwopy.interfaces.pymoo</span> <span class="kn">import</span> <span class="n">Optimizer_pymoo</span>
</code></pre></div>
</div>
</div>
<p>We start by creating a specific class that describes the variables of our problem:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>In [2]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ChargesProblem</span><span class="p">(</span><span class="n">Problem</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy_init</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;charges_problem&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xy_init</span> <span class="o">=</span> <span class="n">xy_init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xy_init</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>

    <span class="k">def</span> <span class="nf">var_names_float</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Defines the variable names&quot;&quot;&quot;</span>
        <span class="n">vnames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">):</span>
            <span class="n">vnames</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;x</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;y</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">vnames</span>

    <span class="k">def</span> <span class="nf">initial_values_float</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns inital values, as given to constructor&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy_init</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">min_values_float</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Minimal values for a square of size 2*radius&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">max_values_float</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Maximal values for a square of size 2*radius&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_individual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vars_int</span><span class="p">,</span> <span class="n">vars_float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns (x, y) variables for each charge&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">vars_float</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vars_int</span><span class="p">,</span> <span class="n">vars_float</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns (x, y) variables for each charge per individual&quot;&quot;&quot;</span>
        <span class="n">n_pop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vars_float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vars_float</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_pop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_fig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a figure showing the charges locations&quot;&quot;&quot;</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;orange&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;darkred&quot;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s2">&quot;box&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;N = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span>
</code></pre></div>
</div>
</div>
<p>There are <span class="math notranslate nohighlight">\(2 N\)</span> variables for this problem, and we order them as <span class="math notranslate nohighlight">\((x_0, y_0, \ldots, x_{N-1}, y_{N-1})\)</span>. This is convenient, since the numpy reshaping operation <code class="docutils literal notranslate"><span class="pre">vars_float.reshape(n_charges,</span> <span class="pre">2)</span></code> then represents an array of <span class="math notranslate nohighlight">\((x_i, y_i)\)</span> type arrays, which is handy for calculations.</p>
<p>Notice the two functions <code class="docutils literal notranslate"><span class="pre">apply_individual</span></code> and <code class="docutils literal notranslate"><span class="pre">apply_population</span></code>. They are being called during optimization whenever new variables are being set by the optimizer, and their purpose is to update the data in the problem class accordingly (excluding objectives and constraints, which we will deal with shortly).</p>
<p>The difference between the two functions is that <code class="docutils literal notranslate"><span class="pre">apply_individual</span></code> evaluates a single vector of new problem variables, whereas <code class="docutils literal notranslate"><span class="pre">apply_population</span></code> handles a full population of such vectors. The implementation of the latter function is not strictly required (alternatively a loop over individuals of the population will be evaluated), but it provides a chance for a vast speed-up by vectorized evaluation. This is particularly beneficial for genetic algorithms or other easily vectorizable
approaches (in fact also the gradient calculation via <code class="docutils literal notranslate"><span class="pre">iwopy</span></code> discretizations makes use of this vectorization). Of course the chosen optimizer must be able to support vectorized evaluation for this to work. Both functions return any kind of evaluation data which will be forwarded to the objective and constraint evaluation.</p>
<p>So far we have only defined the problem variables. Objectives and constraints can be added to the problem via the <code class="docutils literal notranslate"><span class="pre">add_objective</span></code> and <code class="docutils literal notranslate"><span class="pre">add_constraint</span></code> functions, respectively. First, we implement the inverse distance potential as our objective:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>In [3]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MinPotential</span><span class="p">(</span><span class="n">Objective</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">problem</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define the same variable names and ordering as in the problem&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="s2">&quot;potential&quot;</span><span class="p">,</span> <span class="n">vnames_float</span><span class="o">=</span><span class="n">problem</span><span class="o">.</span><span class="n">var_names_float</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">n_charges</span>

    <span class="k">def</span> <span class="nf">n_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The potential is a scalar function, hence one component&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">maximize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Indicates that the single component is to be minimized&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">calc_individual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vars_int</span><span class="p">,</span> <span class="n">vars_float</span><span class="p">,</span> <span class="n">problem_results</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This evaluates the potential. See problem.apply_individual</span>
<span class="sd">        for problem results&quot;&quot;&quot;</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">problem_results</span>
        <span class="n">value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">):</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">xy</span><span class="p">[</span><span class="n">i</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="mf">1e-10</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">dist</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">calc_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vars_int</span><span class="p">,</span> <span class="n">vars_float</span><span class="p">,</span> <span class="n">problem_results</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This evaluates the potential in vectorized manner.</span>
<span class="sd">        See problem.apply_population for problem results&quot;&quot;&quot;</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">problem_results</span>
        <span class="n">n_pop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_pop</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">):</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xy</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">xy</span><span class="p">[:,</span> <span class="n">i</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="mf">1e-10</span>
            <span class="p">)</span>
            <span class="n">value</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">dist</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>
</code></pre></div>
</div>
</div>
<p>Notice that the functions <code class="docutils literal notranslate"><span class="pre">calc_individual</span></code> and its (again optional) vectorized correspondent <code class="docutils literal notranslate"><span class="pre">calc_population</span></code> do not directly make use of the variables vector <code class="docutils literal notranslate"><span class="pre">vars_float</span></code>, which they could (and it would be perfectly fine, even intended), but instead of the <code class="docutils literal notranslate"><span class="pre">problem_results</span></code> provided by the problem functions <code class="docutils literal notranslate"><span class="pre">apply_individual</span></code> and <code class="docutils literal notranslate"><span class="pre">apply_population</span></code>.</p>
<p>Next, we implement the <span class="math notranslate nohighlight">\(N\)</span> radial constraints:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>In [4]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">MaxRadius</span><span class="p">(</span><span class="n">Constraint</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">problem</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define the same variable names and ordering as in the problem&quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">problem</span><span class="p">,</span> <span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="n">vnames_float</span><span class="o">=</span><span class="n">problem</span><span class="o">.</span><span class="n">var_names_float</span><span class="p">(),</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">n_charges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">radius</span>

    <span class="k">def</span> <span class="nf">n_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;One constraint per charge&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span>

    <span class="k">def</span> <span class="nf">vardeps_float</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Boolean array that defines which component depends</span>
<span class="sd">        on which variable (optional, default is on all)&quot;&quot;&quot;</span>
        <span class="n">deps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">deps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">deps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">deps</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">(),</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calc_individual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vars_int</span><span class="p">,</span> <span class="n">vars_float</span><span class="p">,</span> <span class="n">problem_results</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This evaluates the constraints, negative values are valid.</span>
<span class="sd">        See problem.apply_individual for problem results&quot;&quot;&quot;</span>
        <span class="n">components</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">s_</span><span class="p">[:]</span> <span class="k">if</span> <span class="n">components</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">components</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">problem_results</span><span class="p">[</span><span class="n">components</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span>

    <span class="k">def</span> <span class="nf">calc_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vars_int</span><span class="p">,</span> <span class="n">vars_float</span><span class="p">,</span> <span class="n">problem_results</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;This evaluates the constraints in vectorized manner,</span>
<span class="sd">        negative values are valid. See problem.apply_population for</span>
<span class="sd">        problem results&quot;&quot;&quot;</span>
        <span class="n">components</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">s_</span><span class="p">[:]</span> <span class="k">if</span> <span class="n">components</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">components</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">problem_results</span><span class="p">[:,</span> <span class="n">components</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span>
</code></pre></div>
</div>
</div>
<p>Note that by default, negative constraint values represent validity. This can be changed by overloading the function <code class="docutils literal notranslate"><span class="pre">get_bounds</span></code> of the base class, see API, but is not recommended.</p>
<p>Also note that the function <code class="docutils literal notranslate"><span class="pre">vardeps_float</span></code> is only relevant for gradient based solvers that support gradient sparsity (e.g. <code class="docutils literal notranslate"><span class="pre">pygmo.ipopt</span></code>). It is irrelevant for the genetic algorithm that we want to use in this example, but added for the sake of completeness.</p>
<p>Now let’s add the objective and the constraints and initialize the problem:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>In [5]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span class="n">N</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">R</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># generate random initial coordinates of the N charges:</span>
<span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">R</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">R</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">problem</span> <span class="o">=</span> <span class="n">ChargesProblem</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="n">MinPotential</span><span class="p">(</span><span class="n">problem</span><span class="p">))</span>
<span class="n">problem</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">MaxRadius</span><span class="p">(</span><span class="n">problem</span><span class="p">))</span>
<span class="n">problem</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_fig</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Problem &#39;charges_problem&#39; (ChargesProblem): Initializing
--------------------------------------------------------
  n_vars_int  : 0
  n_vars_float: 40
--------------------------------------------------------
  n_objectives: 1
  n_obj_cmptns: 1
--------------------------------------------------------
  n_constraints: 1
  n_con_cmptns: 20
--------------------------------------------------------
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_electrostatics_10_1.png" src="../_images/notebooks_electrostatics_10_1.png" />
</div>
</div>
<p>Finally, we can now setup the genetic algorithm <a class="reference external" href="https://pymoo.org/algorithms/soo/ga.html">GA from pymoo</a> and solve the problem, here in vectorized form (flag <code class="docutils literal notranslate"><span class="pre">vectorize=True</span></code>):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>In [6]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span class="n">solver</span> <span class="o">=</span> <span class="n">Optimizer_pymoo</span><span class="p">(</span>
    <span class="n">problem</span><span class="p">,</span>
    <span class="n">problem_pars</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">vectorize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">algo_pars</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;GA&quot;</span><span class="p">,</span>
        <span class="n">pop_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">setup_pars</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
    <span class="n">term_pars</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
        <span class="n">n_max_gen</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">ftol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>
        <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="n">solver</span><span class="o">.</span><span class="n">print_info</span><span class="p">()</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Loading pymoo
pymoo successfully loaded
Initializing Optimizer_pymoo
Selecting sampling: float_random (FloatRandomSampling)
Selecting algorithm: GA (GA)
Selecting termination: default (DefaultSingleObjectiveTermination)

Problem:
--------
  vectorize: True

Algorithm:
----------
  type: GA
  pop_size: 100
  seed: 1

Termination:
------------
  n_max_gen: 300
  ftol: 1e-06
  xtol: 1e-06



Optimizer_pymoo: Optimization run finished
  Success: True
  Best potential = 78.69922244245727
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>In [7]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="n">xy</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">problem_results</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_fig</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Results problem &#39;charges_problem&#39;:
-----------------------------------
  Float variables:
    0: x0  = 2.236112e+00
    1: y0  = -4.470885e+00
    2: x1  = 2.082072e+00
    3: y1  = 7.199634e-01
    4: x2  = 4.258628e+00
    5: y2  = 2.615461e+00
    6: x3  = 4.931458e+00
    7: y3  = 8.239395e-01
    8: x4  = -3.453717e+00
    9: y4  = -3.615375e+00
    10: x5  = -2.459065e+00
    11: y5  = 4.351725e+00
    12: x6  = -6.527966e-01
    13: y6  = 2.161302e+00
    14: x7  = 1.670812e+00
    15: y7  = -2.382281e+00
    16: x8  = -1.235636e+00
    17: y8  = -1.913568e+00
    18: x9  = -2.099603e+00
    19: y9  = -4.536876e+00
    20: x10 = -4.701957e+00
    21: y10 = -1.697765e+00
    22: x11 = 1.517358e+00
    23: y11 = 4.762982e+00
    24: x12 = 4.845131e+00
    25: y12 = -1.233574e+00
    26: x13 = 4.140025e+00
    27: y13 = -2.796535e+00
    28: x14 = 2.992287e+00
    29: y14 = 4.004978e+00
    30: x15 = 2.484520e-02
    31: y15 = -4.999799e+00
    32: x16 = -4.887334e+00
    33: y16 = 1.053824e+00
    34: x17 = -3.199172e+00
    35: y17 = 1.417813e-01
    36: x18 = -3.795050e+00
    37: y18 = 3.249910e+00
    38: x19 = -4.806220e-01
    39: y19 = 4.976805e+00
-----------------------------------
  Objectives:
    0: potential = 7.869922e+01
-----------------------------------
  Constraints:
    0: radius_0  = -1.098864e-03
    1: radius_1  = -2.796963e+00
    2: radius_2  = -2.345300e-03
    3: radius_3  = -1.849789e-04
    4: radius_4  = -8.972586e-05
    5: radius_5  = -1.548850e-03
    6: radius_6  = -2.742264e+00
    7: radius_7  = -2.090210e+00
    8: radius_8  = -2.722163e+00
    9: radius_9  = -8.424672e-04
    10: radius_10 = -9.192331e-04
    11: radius_11 = -1.163198e-03
    12: radius_12 = -3.001922e-04
    13: radius_13 = -3.960526e-03
    14: radius_14 = -6.371277e-04
    15: radius_15 = -1.389087e-04
    16: radius_16 = -3.424350e-04
    17: radius_17 = -1.797687e+00
    18: radius_18 = -3.568959e-03
    19: radius_19 = -4.112099e-05
-----------------------------------
  Success: True
-----------------------------------

</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_electrostatics_13_1.png" src="../_images/notebooks_electrostatics_13_1.png" />
</div>
</div>
<p>Note that this problem has many equivalent solutions, and the displayed result is the best solution that the genetic algorithm was able to find within its convergence criteria. With heuristic methods there is generally no guarantee or proof that a global optimum has been found. However, the objective function has clearly been minimized, and therefore the “design” was improved which is often the goal in engineering tasks.</p>
<p>For the fun of it, let’s also solve the problem using iwopy’s <code class="docutils literal notranslate"><span class="pre">GG</span></code> solver (stands for <em>Greedy Gradient</em>), now for 50 charges. This solver is a simple steepest decent algorithm which projects out directions that would violate constraints (and reverts those that already do). It supports iwopy’s vectorization capabilities and hence can run fast for many variables. Of course it is not as advanced as other gradient based solvers, but for this particular problem it does a good job:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>In [8]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">iwopy</span> <span class="kn">import</span> <span class="n">LocalFD</span>
<span class="kn">from</span> <span class="nn">iwopy.optimizers</span> <span class="kn">import</span> <span class="n">GG</span>
</code></pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>In [9]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span class="n">N</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">R</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">R</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">R</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">problem</span> <span class="o">=</span> <span class="n">ChargesProblem</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="n">MinPotential</span><span class="p">(</span><span class="n">problem</span><span class="p">))</span>
<span class="n">problem</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">MaxRadius</span><span class="p">(</span><span class="n">problem</span><span class="p">))</span>

<span class="n">gproblem</span> <span class="o">=</span> <span class="n">LocalFD</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">deltas</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span> <span class="n">fd_order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">gproblem</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

<span class="n">solver</span> <span class="o">=</span> <span class="n">GG</span><span class="p">(</span>
    <span class="n">gproblem</span><span class="p">,</span>
    <span class="n">step_max</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">step_min</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
    <span class="n">vectorized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Problem &#39;charges_problem&#39; (ChargesProblem): Initializing
--------------------------------------------------------
  n_vars_int  : 0
  n_vars_float: 100
--------------------------------------------------------
  n_objectives: 1
  n_obj_cmptns: 1
--------------------------------------------------------
  n_constraints: 1
  n_con_cmptns: 50
--------------------------------------------------------
Problem &#39;charges_problem_fd&#39; (LocalFD): Initializing
----------------------------------------------------
  n_vars_int  : 0
  n_vars_float: 100
----------------------------------------------------
  n_objectives: 1
  n_obj_cmptns: 1
----------------------------------------------------
  n_constraints: 1
  n_con_cmptns: 50
----------------------------------------------------
GG: Optimization run finished
  Success: True
  Best potential = 585.5754719667092
Results problem &#39;charges_problem_fd&#39;:
--------------------------------------
  Float variables:
    0: x0  = 1.087311e-01
    1: y0  = 3.652947e+00
    2: x1  = -4.606218e+00
    3: y1  = 1.944930e+00
    4: x2  = -1.887607e+00
    5: y2  = -4.630003e+00
    6: x3  = 3.562191e+00
    7: y3  = 4.047046e-01
    8: x4  = 1.485097e+00
    9: y4  = 1.052208e+00
    10: x5  = 3.858055e+00
    11: y5  = 3.180473e+00
    12: x6  = -4.141494e+00
    13: y6  = -2.801432e+00
    14: x7  = -4.122978e+00
    15: y7  = 2.828613e+00
    16: x8  = -8.834537e-01
    17: y8  = -3.429528e+00
    18: x9  = 2.007586e+00
    19: y9  = -4.579257e+00
    20: x10 = -3.463435e+00
    21: y10 = 3.606192e+00
    22: x11 = 1.932276e-01
    23: y11 = -1.712766e+00
    24: x12 = -1.579416e+00
    25: y12 = 3.213613e+00
    26: x13 = 1.743332e+00
    27: y13 = 3.151292e+00
    28: x14 = -1.420385e+00
    29: y14 = -9.827574e-01
    30: x15 = 3.402227e+00
    31: y15 = -1.309271e+00
    32: x16 = -3.366573e+00
    33: y16 = -1.166486e+00
    34: x17 = -4.900849e+00
    35: y17 = -9.907955e-01
    36: x18 = 2.878439e+00
    37: y18 = -4.088348e+00
    38: x19 = 1.042442e+00
    39: y19 = -4.890124e+00
    40: x20 = 3.120221e+00
    41: y20 = 3.906946e+00
    42: x21 = 4.444495e+00
    43: y21 = 2.290517e+00
    44: x22 = 3.645875e+00
    45: y22 = -3.421637e+00
    46: x23 = 2.536083e-01
    47: y23 = 4.993564e+00
    48: x24 = 3.064096e+00
    49: y24 = 2.047608e+00
    50: x25 = 4.740609e-02
    51: y25 = -4.999775e+00
    52: x26 = -3.516980e+00
    53: y26 = -3.553991e+00
    54: x27 = -7.810981e-01
    55: y27 = 4.938612e+00
    56: x28 = -4.607438e+00
    57: y28 = -1.942042e+00
    58: x29 = 1.275371e+00
    59: y29 = 4.834607e+00
    60: x30 = 4.255719e+00
    61: y30 = -2.624664e+00
    62: x31 = -1.127440e-01
    63: y31 = 1.802090e+00
    64: x32 = -2.673215e+00
    65: y32 = 4.225390e+00
    66: x33 = -2.750043e+00
    67: y33 = -4.175796e+00
    68: x34 = 2.240040e+00
    69: y34 = 4.470148e+00
    70: x35 = -2.396197e+00
    71: y35 = -2.639390e+00
    72: x36 = -2.902047e+00
    73: y36 = 2.146349e+00
    74: x37 = 2.344344e+00
    75: y37 = -2.683691e+00
    76: x38 = 4.819316e+00
    77: y38 = 1.331988e+00
    78: x39 = -3.530091e+00
    79: y39 = 5.240002e-01
    80: x40 = 4.990310e+00
    81: y40 = 3.111336e-01
    82: x41 = -9.358615e-01
    83: y41 = -4.911636e+00
    84: x42 = 4.702197e+00
    85: y42 = -1.699806e+00
    86: x43 = 8.549782e-01
    87: y43 = -3.505766e+00
    88: x44 = -4.999989e+00
    89: y44 = -1.061685e-02
    90: x45 = -4.900949e+00
    91: y45 = 9.903010e-01
    92: x46 = 4.949815e+00
    93: y46 = -7.066317e-01
    94: x47 = 1.642586e+00
    95: y47 = -7.069032e-01
    96: x48 = -1.757321e+00
    97: y48 = 4.681007e+00
    98: x49 = -1.552179e+00
    99: y49 = 7.801572e-01
--------------------------------------
  Objectives:
    0: potential = 5.855755e+02
--------------------------------------
  Constraints:
    0: radius_0  = -1.345435e+00
    1: radius_1  = 1.247216e-07
    2: radius_2  = -6.293392e-07
    3: radius_3  = -1.414893e+00
    4: radius_4  = -3.179930e+00
    5: radius_5  = -6.227472e-10
    6: radius_6  = -3.288465e-07
    7: radius_7  = -4.991725e-08
    8: radius_8  = -1.458509e+00
    9: radius_9  = -1.129005e-07
    10: radius_10 = 1.821135e-08
    11: radius_11 = -3.276369e+00
    12: radius_12 = -1.419237e+00
    13: radius_13 = -1.398633e+00
    14: radius_14 = -3.272775e+00
    15: radius_15 = -1.354546e+00
    16: radius_16 = -1.437065e+00
    17: radius_17 = -5.599746e-07
    18: radius_18 = 4.179612e-08
    19: radius_19 = 2.246986e-07
    20: radius_20 = 1.327298e-09
    21: radius_21 = 4.092386e-09
    22: radius_22 = -2.982356e-08
    23: radius_23 = 2.657750e-09
    24: radius_24 = -1.314707e+00
    25: radius_25 = -4.232622e-07
    26: radius_26 = 1.408324e-07
    27: radius_27 = -9.170680e-09
    28: radius_28 = 7.811203e-07
    29: radius_29 = 5.608240e-09
    30: radius_30 = 7.925003e-09
    31: radius_31 = -3.194387e+00
    32: radius_32 = -2.086939e-08
    33: radius_33 = 6.383923e-07
    34: radius_34 = 4.152908e-09
    35: radius_35 = -1.435152e+00
    36: radius_36 = -1.390472e+00
    37: radius_37 = -1.436554e+00
    38: radius_38 = 7.981631e-09
    39: radius_39 = -1.431231e+00
    40: radius_40 = 6.595215e-09
    41: radius_41 = 6.953370e-07
    42: radius_42 = -5.153245e-09
    43: radius_43 = -1.391485e+00
    44: radius_44 = 4.658783e-07
    45: radius_45 = -2.144952e-07
    46: radius_46 = 9.729153e-09
    47: radius_47 = -3.211760e+00
    48: radius_48 = 7.765166e-10
    49: radius_49 = -3.262789e+00
--------------------------------------
  Success: True
--------------------------------------

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span><code>In [10]:
</code></pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><code><span class="n">xy</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">problem_results</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_fig</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_electrostatics_17_0.png" src="../_images/notebooks_electrostatics_17_0.png" />
</div>
</div>






                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="simple_function.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Simple function minimization" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Simple function minimization
            </div>
          </div>
        </a>
      
      
        
        <a href="multi_obj_chain.html" class="md-footer__link md-footer__link--next" aria-label="Next: Multi objective geometric chain" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Multi objective geometric chain
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        &#169; Copyright 2024, Fraunhofer IWES.
        
    </div>
  
    Created using
    <a href="https://www.sphinx-doc.org/" target="_blank" rel="noopener">Sphinx</a>
    8.1.3.
     and
    <a href="https://github.com/jbms/sphinx-immaterial/" target="_blank" rel="noopener">Sphinx-Immaterial</a>
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
      
        <script src="../_static/sphinx_immaterial_theme.f9d9eeeb247ace16c.min.js?v=8ec58cb5"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"TeX": {"equationNumbers": {"autoNumber": "AMS", "useLabelIds": true}}, "tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script id="MathJax-script" src="../_static/mathjax/tex-mml-chtml.js?v=cadf963e"></script>
    
  </body>
</html>