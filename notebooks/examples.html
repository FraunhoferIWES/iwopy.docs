<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Examples &mdash; iwopy 0.0.15
 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"TeX": {"equationNumbers": {"autoNumber": "AMS", "useLabelIds": true}}, "tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API" href="../api.html" />
    <link rel="prev" title="Installation" href="../installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> iwopy
          </a>
              <div class="version">
                0.0.15

              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#requirements">Requirements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#virtual-python-environment">Virtual Python environment</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#standard-users">Standard users</a></li>
<li class="toctree-l2"><a class="reference internal" href="../installation.html#developers">Developers</a></li>
</ul>
</li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#Simple-function-minimization">Simple function minimization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#Electrostatic-potential-minimization">Electrostatic potential minimization</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/iwopy.benchmarks.html">iwopy.benchmarks</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.benchmarks.branin.html">iwopy.benchmarks.branin</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.benchmarks.branin.BraninObjective.html">iwopy.benchmarks.branin.BraninObjective</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.benchmarks.branin.BraninProblem.html">iwopy.benchmarks.branin.BraninProblem</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.benchmarks.rosenbrock.html">iwopy.benchmarks.rosenbrock</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.benchmarks.rosenbrock.RosenbrockObjective.html">iwopy.benchmarks.rosenbrock.RosenbrockObjective</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.benchmarks.rosenbrock.RosenbrockProblem.html">iwopy.benchmarks.rosenbrock.RosenbrockProblem</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/iwopy.core.html">iwopy.core</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.core.base.html">iwopy.core.base</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.core.base.Base.html">iwopy.core.base.Base</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.core.constraint.html">iwopy.core.constraint</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.core.constraint.Constraint.html">iwopy.core.constraint.Constraint</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.core.function.html">iwopy.core.function</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.core.function.OptFunction.html">iwopy.core.function.OptFunction</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.core.function_list.html">iwopy.core.function_list</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.core.function_list.OptFunctionList.html">iwopy.core.function_list.OptFunctionList</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.core.function_subset.html">iwopy.core.function_subset</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.core.function_subset.OptFunctionSubset.html">iwopy.core.function_subset.OptFunctionSubset</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.core.memory.html">iwopy.core.memory</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.core.memory.get_default_keyf.html">iwopy.core.memory.get_default_keyf</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.core.memory.Memory.html">iwopy.core.memory.Memory</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.core.objective.html">iwopy.core.objective</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.core.objective.Objective.html">iwopy.core.objective.Objective</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.core.opt_results.html">iwopy.core.opt_results</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.core.opt_results.OptResults.html">iwopy.core.opt_results.OptResults</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.core.optimizer.html">iwopy.core.optimizer</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.core.optimizer.Optimizer.html">iwopy.core.optimizer.Optimizer</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.core.problem.html">iwopy.core.problem</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.core.problem.Problem.html">iwopy.core.problem.Problem</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.core.problem.ProblemDefaultFunc.html">iwopy.core.problem.ProblemDefaultFunc</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/iwopy.interfaces.html">iwopy.interfaces</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.interfaces.pygmo.html">iwopy.interfaces.pygmo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.interfaces.pygmo.algos.html">iwopy.interfaces.pygmo.algos</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.interfaces.pygmo.imports.html">iwopy.interfaces.pygmo.imports</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.interfaces.pygmo.optimizer.html">iwopy.interfaces.pygmo.optimizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.interfaces.pygmo.problem.html">iwopy.interfaces.pygmo.problem</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.interfaces.pymoo.html">iwopy.interfaces.pymoo</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.interfaces.pymoo.factory.html">iwopy.interfaces.pymoo.factory</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.interfaces.pymoo.imports.html">iwopy.interfaces.pymoo.imports</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.interfaces.pymoo.optimizer.html">iwopy.interfaces.pymoo.optimizer</a></li>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.interfaces.pymoo.problem.html">iwopy.interfaces.pymoo.problem</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/iwopy.utils.html">iwopy.utils</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.utils.discretization.html">iwopy.utils.discretization</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.utils.discretization.RegularDiscretizationGrid.html">iwopy.utils.discretization.RegularDiscretizationGrid</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.utils.stdout.html">iwopy.utils.stdout</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.utils.stdout.suppress_stdout.html">iwopy.utils.stdout.suppress_stdout</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../_autosummary/iwopy.wrappers.html">iwopy.wrappers</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.wrappers.discretize_reg_grid.html">iwopy.wrappers.discretize_reg_grid</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.wrappers.discretize_reg_grid.DiscretizeRegGrid.html">iwopy.wrappers.discretize_reg_grid.DiscretizeRegGrid</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.wrappers.local_fd.html">iwopy.wrappers.local_fd</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.wrappers.local_fd.LocalFD.html">iwopy.wrappers.local_fd.LocalFD</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.wrappers.problem_wrapper.html">iwopy.wrappers.problem_wrapper</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.wrappers.problem_wrapper.ProblemWrapper.html">iwopy.wrappers.problem_wrapper.ProblemWrapper</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.wrappers.simple_constraint.html">iwopy.wrappers.simple_constraint</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.wrappers.simple_constraint.SimpleConstraint.html">iwopy.wrappers.simple_constraint.SimpleConstraint</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.wrappers.simple_objective.html">iwopy.wrappers.simple_objective</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.wrappers.simple_objective.SimpleObjective.html">iwopy.wrappers.simple_objective.SimpleObjective</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../_autosummary/iwopy.wrappers.simple_problem.html">iwopy.wrappers.simple_problem</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../_autosummary/iwopy.wrappers.simple_problem.SimpleProblem.html">iwopy.wrappers.simple_problem.SimpleProblem</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../history.html">History</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../history.html#v0-0-11-alpha">v0.0.11-alpha</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history.html#v0-0-12-alpha">v0.0.12-alpha</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history.html#v0-0-13-alpha">v0.0.13-alpha</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history.html#v0-0-14-alpha">v0.0.14-alpha</a></li>
<li class="toctree-l2"><a class="reference internal" href="../history.html#v0-0-15-alpha">v0.0.15-alpha</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">iwopy</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Examples</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/notebooks/examples.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="Examples">
<h1>Examples<a class="headerlink" href="#Examples" title="Permalink to this heading"></a>
</h1>
<section id="Simple-function-minimization">
<h2>Simple function minimization<a class="headerlink" href="#Simple-function-minimization" title="Permalink to this heading"></a>
</h2>
<p>Let’s minimize the following simple function:</p>
<div class="math notranslate nohighlight">
\[f(x, y) = (x - 3.6)^2 + 2 (y+1.1)^2\]</div>
<p>The global minimum is obvious: <span class="math notranslate nohighlight">\(f=0\)</span> for <span class="math notranslate nohighlight">\(x=3.6, y=-1.1\)</span>. We now want to find this minimum using <code class="docutils literal notranslate"><span class="pre">iwopy</span></code>, in a setup as follows:</p>
<ul class="simple">
<li><p>Parameter bounds: <span class="math notranslate nohighlight">\(x, y \in [-5,5]\)</span></p></li>
<li><p>Unconstrained minimization</p></li>
<li><p>Gradient based optimizer <a class="reference external" href="https://esa.github.io/pagmo2/docs/cpp/algorithms/ipopt.html">IPOPT</a> from <a class="reference external" href="https://esa.github.io/pygmo2/">pygmo</a></p></li>
<li><p>Analytical gradients</p></li>
</ul>
<p>The usage of finite difference gradients will be demonstrated directly after. We start by importing the required classes from the <code class="docutils literal notranslate"><span class="pre">iwopy</span></code> package:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">iwopy</span> <span class="kn">import</span> <span class="n">SimpleProblem</span><span class="p">,</span> <span class="n">SimpleObjective</span>
<span class="kn">from</span> <span class="nn">iwopy.interfaces.pygmo</span> <span class="kn">import</span> <span class="n">Optimizer_pygmo</span>
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">SimpleProblem</span></code> will be instantiated with two float type variables <code class="docutils literal notranslate"><span class="pre">x</span></code> and <code class="docutils literal notranslate"><span class="pre">y</span></code> which will be passed on to all linked objectives and constraints. The <code class="docutils literal notranslate"><span class="pre">SimpleObjective</span></code> (and also the <code class="docutils literal notranslate"><span class="pre">SimpleConstraint</span></code> classes assume the same variables as the problem, in the same order. We can therefore implement the above function <span class="math notranslate nohighlight">\(f(x, y)\)</span> and the derivative</p>
<div class="math notranslate nohighlight">
\[\begin{split}g(v, x, y) = \left\{
\begin{array}{ll}
\mathrm df / \mathrm dx \ ,&amp; \text{if} \ v = 0 \\
\mathrm df / \mathrm dy \ ,&amp; \text{if} \ v = 1
\end{array}
\right.\end{split}\]</div>
<p>in a straight forward manner:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MinFunc</span><span class="p">(</span><span class="n">SimpleObjective</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">3.6</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="k">def</span> <span class="nf">g</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">components</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="mf">3.6</span><span class="p">)</span> <span class="k">if</span> <span class="n">v</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="mf">1.1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>Notice that the <code class="docutils literal notranslate"><span class="pre">components</span></code> argument of the function <code class="docutils literal notranslate"><span class="pre">g</span></code> is not used here since <code class="docutils literal notranslate"><span class="pre">f</span></code> is a single-component function.</p>
<p>In the case of multi-component functions the parameter <code class="docutils literal notranslate"><span class="pre">n_components</span></code> has to be passed to the <code class="docutils literal notranslate"><span class="pre">__init__</span></code> function of <code class="docutils literal notranslate"><span class="pre">SimpleObjective</span></code>, and <code class="docutils literal notranslate"><span class="pre">f</span></code> has to return a list of scalars. In that case also <code class="docutils literal notranslate"><span class="pre">g</span></code> has to return a list of results, with same length as the requested <code class="docutils literal notranslate"><span class="pre">components</span></code>. The same rules apply to classes derived from <code class="docutils literal notranslate"><span class="pre">SimpleConstraint</span></code>.</p>
<p>We can now proceed and setup the problem:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">SimpleProblem</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">"minf"</span><span class="p">,</span>
    <span class="n">float_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"x"</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">],</span>
    <span class="n">init_values_float</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
    <span class="n">min_values_float</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">],</span>
    <span class="n">max_values_float</span><span class="o">=</span><span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="n">MinFunc</span><span class="p">(</span><span class="n">problem</span><span class="p">))</span>
<span class="n">problem</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Problem 'minf' (SimpleProblem): Initializing
--------------------------------------------
  n_vars_int   : 0
  n_vars_float : 2
--------------------------------------------
  n_objectives : 1
  n_obj_cmptns : 1
--------------------------------------------
  n_constraints: 0
  n_con_cmptns : 0
--------------------------------------------
</pre></div>
</div>
</div>
<p>Note that in a similar way you can easily add constraints to the problem, by defining them in a class that is derived from <code class="docutils literal notranslate"><span class="pre">iwopy.Constraint</span></code> or <code class="docutils literal notranslate"><span class="pre">iwopy.SimpleConstraint</span></code> and then adding them via <code class="docutils literal notranslate"><span class="pre">problem.add_constraint(...)</span></code>.</p>
<p>Adding additional objectives works in the same way, simply repeat <code class="docutils literal notranslate"><span class="pre">problem.add_objective(...)</span></code> as often as you want. However, be aware that not all optimizers can handle multiple objective cases.</p>
<p>Next, we create and initialize the solver:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="n">solver</span> <span class="o">=</span> <span class="n">Optimizer_pygmo</span><span class="p">(</span>
    <span class="n">problem</span><span class="p">,</span>
    <span class="n">problem_pars</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
    <span class="n">algo_pars</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">"ipopt"</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="n">solver</span><span class="o">.</span><span class="n">print_info</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Algorithm name: Ipopt: Interior Point Optimization [deterministic]
        C++ class name: pagmo::ipopt

        Thread safety: none

Extra info:
        Last optimisation return code: Solve_Succeeded (value = 0)
        Verbosity: 1
        Individual selection policy: best
        Individual replacement policy: best
        Numeric options: {tol : 0.0001}

</pre></div>
</div>
</div>
<p>Here <code class="docutils literal notranslate"><span class="pre">tol</span></code> is an <code class="docutils literal notranslate"><span class="pre">IPOPT</span></code> parameter that defines the convergence tolerance. Now we are finally ready - let’s solve the problem!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="n">results</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="n">solver</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

******************************************************************************
This program contains Ipopt, a library for large-scale nonlinear optimization.
 Ipopt is released as open source code under the Eclipse Public License (EPL).
         For more information visit http://projects.coin-or.org/Ipopt
******************************************************************************


 objevals:        objval:      violated:    viol. norm:
         1          15.38              0              0
         2        9.23375              0              0
         3        9.23375              0              0
         4        9.23375              0              0
         5        9.23375              0              0
         6        9.23375              0              0
         7        1.60594              0              0
         8      0.0440281              0              0
         9     0.00157443              0              0
        10    1.35988e-06              0              0

Problem name: minf
        C++ class name: pybind11::object

        Global dimension:                       2
        Integer dimension:                      0
        Fitness dimension:                      1
        Number of objectives:                   1
        Equality constraints dimension:         0
        Inequality constraints dimension:       0
        Lower bounds: [-5, -5]
        Upper bounds: [5, 5]
        Has batch fitness evaluation: false

        Has gradient: true
        User implemented gradient sparsity: true
        Expected gradients: 2
        Has hessians: false
        User implemented hessians sparsity: false

        Fitness evaluations: 14
        Gradient evaluations: 7

        Thread safety: none

Population size: 1

List of individuals:
#0:
        ID:                     2860610128850480351
        Decision vector:        [3.6, -1.1]
        Fitness vector:         [1.28522e-12]

Champion decision vector: [3.6, -1.1]
Champion fitness: [1.28522e-12]



Optimizer_pygmo: Optimization run finished
  Success: True
  Best f = 1.2852212531163044e-12
        11    1.28522e-12              0              0
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Results problem 'minf':
------------------------
  Float variables:
    0: x = 3.599999e+00
    1: y = -1.100000e+00
------------------------
  Objectives:
    0: f = 1.285221e-12
------------------------
  Success: True
------------------------

</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">results</span></code> object is an instance of the class <code class="docutils literal notranslate"><span class="pre">OptResults</span></code>, cf. API. it carries attributes</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">vars_int</span></code>: The integer variables of the solution</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vars_float</span></code>: The float variables of the solution</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">objs</span></code>: The objective function values of the solution</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cons</span></code>: The constraint function values of the solution</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">problem_results</span></code>: The object returned by the problem when applying the solution</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">success</span></code> : Boolean flag indicating a successful solution</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vnames_int</span></code>: The names of the integer variables</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">vnames_float</span></code>: The names of the float variables</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">onames</span></code>: The names of the objectives (all components)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cnames</span></code>: The names of the constraints (all components)</p></li>
</ul>
<p>Next, we want to explore finite difference gradient calculations for the same example. We can either remove the function <code class="docutils literal notranslate"><span class="pre">g(v,</span> <span class="pre">x,</span> <span class="pre">y,</span> <span class="pre">components)</span></code> from the <code class="docutils literal notranslate"><span class="pre">MinFunc</span></code> class, or create it invoking the parameter <code class="docutils literal notranslate"><span class="pre">has_ana_derivs=False</span></code>. This will then ignore the analytical gradient definition in the class.</p>
<p>Additionally, we need to wrap the problem into a wrapper that provides numerical derivatives. There are two choices:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DiscretizeRegGrid</span></code>: A wrapper that evaluates the problem on a regular grid and calculates derivatives based on fixed grid point locations. Interpolation in between is optional (and increases the number of required function evaluations). The grid also offers a memory such that re-calculations of grid point results are minimized.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LocalFD</span></code>: A wrapper that evaluates local finite difference rules for derivative calculations. Hence the problem evaluation points are defined based on the current variables and hence not memorized since those usually differ with every call.</p></li>
</ul>
<p>The <code class="docutils literal notranslate"><span class="pre">LocalFD</span></code> is usually the faster choice, unless you are expecting a lot of benefits from the memory capabilities of the regular grid. Here is an example how to use it for solving our problem:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">iwopy</span> <span class="kn">import</span> <span class="n">LocalFD</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="n">problem</span> <span class="o">=</span> <span class="n">SimpleProblem</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">"minf"</span><span class="p">,</span>
    <span class="n">float_vars</span><span class="o">=</span><span class="p">[</span><span class="s2">"x"</span><span class="p">,</span> <span class="s2">"y"</span><span class="p">],</span>
    <span class="n">init_values_float</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
    <span class="n">min_values_float</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">],</span>
    <span class="n">max_values_float</span><span class="o">=</span><span class="p">[</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="n">MinFunc</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">has_ana_derivs</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="n">gproblem</span> <span class="o">=</span> <span class="n">LocalFD</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">deltas</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="n">fd_order</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">gproblem</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Problem 'minf' (SimpleProblem): Initializing
--------------------------------------------
  n_vars_int   : 0
  n_vars_float : 2
--------------------------------------------
  n_objectives : 1
  n_obj_cmptns : 1
--------------------------------------------
  n_constraints: 0
  n_con_cmptns : 0
--------------------------------------------
Problem 'minf_fd' (LocalFD): Initializing
-----------------------------------------
  n_vars_int   : 0
  n_vars_float : 2
-----------------------------------------
  n_objectives : 1
  n_obj_cmptns : 1
-----------------------------------------
  n_constraints: 0
  n_con_cmptns : 0
-----------------------------------------
</pre></div>
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">gproblem</span></code> object now corresponds to original <code class="docutils literal notranslate"><span class="pre">problem</span></code> with finite difference gradients of order 2. We can use the same gradient based solver as above for solving this problem:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="n">solver</span> <span class="o">=</span> <span class="n">Optimizer_pygmo</span><span class="p">(</span>
    <span class="n">gproblem</span><span class="p">,</span>
    <span class="n">problem_pars</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
    <span class="n">algo_pars</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">type</span><span class="o">=</span><span class="s2">"ipopt"</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="n">solver</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>

Optimisation return status: Solve_Succeeded (value = 0)

 objevals:        objval:      violated:    viol. norm:
         1          15.38              0              0
         2        9.23375              0              0
         3        9.23375              0              0
         4        9.23375              0              0
         5        9.23375              0              0
         6        9.23375              0              0
         7        1.60594              0              0
         8      0.0440281              0              0
         9     0.00157443              0              0
        10    1.35988e-06              0              0
        11    1.28522e-12              0              0

Problem name: minf_fd
        C++ class name: pybind11::object

        Global dimension:                       2
        Integer dimension:                      0
        Fitness dimension:                      1
        Number of objectives:                   1
        Equality constraints dimension:         0
        Inequality constraints dimension:       0
        Lower bounds: [-5, -5]
        Upper bounds: [5, 5]
        Has batch fitness evaluation: false

        Has gradient: true
        User implemented gradient sparsity: true
        Expected gradients: 2
        Has hessians: false
        User implemented hessians sparsity: false

        Fitness evaluations: 14
        Gradient evaluations: 7

        Thread safety: none

Population size: 1

List of individuals:
#0:
        ID:                     8859142894084493550
        Decision vector:        [3.6, -1.1]
        Fitness vector:         [1.28522e-12]

Champion decision vector: [3.6, -1.1]
Champion fitness: [1.28522e-12]



Optimizer_pygmo: Optimization run finished
  Success: True
  Best f = 1.285221254342924e-12
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Results problem 'minf_fd':
---------------------------
  Float variables:
    0: x = 3.599999e+00
    1: y = -1.100000e+00
---------------------------
  Objectives:
    0: f = 1.285221e-12
---------------------------
  Success: True
---------------------------

</pre></div>
</div>
</div>
</section>
<section id="Electrostatic-potential-minimization">
<h2>Electrostatic potential minimization<a class="headerlink" href="#Electrostatic-potential-minimization" title="Permalink to this heading"></a>
</h2>
<p>The main purpose of <code class="docutils literal notranslate"><span class="pre">iwopy</span></code> is to be helpful when attacking more complicated optimization tasks than the minimization of simple analytical functions as above. As an example, we consider the minimization of an inverse distance type potential for a fully coupled system of <span class="math notranslate nohighlight">\(N\)</span> particles in two dimensions. We can imagine such a system to be composed of <span class="math notranslate nohighlight">\(N\)</span> individual point charges, each of them carrying the same electric unit charge. The potential that we want to minimize is then
represented by</p>
<div class="math notranslate nohighlight">
\[\begin{split}V = \sum_{i\neq j} \frac 1 {|\mathrm r_i - \mathrm r_j|} \ , \quad \text{where} \quad \mathrm r_i = \left( \begin{array}{c} x_i \\ y_i \end{array} \right)\end{split}\]</div>
<p>denotes the two dimensional position vector of charge <span class="math notranslate nohighlight">\(i\)</span> and the sum is over all unequal index pairs. This potential favours large distances between charges, hence we need to constrain them to a certain area for a meaningful solution. We confine them to a circle of radius <span class="math notranslate nohighlight">\(R\)</span> by imposing <span class="math notranslate nohighlight">\(N\)</span> constraints,</p>
<div class="math notranslate nohighlight">
\[|\mathrm r_i| \leq R \ , \quad \text{for all} \quad i = 0 \ldots N-1 \ .\]</div>
<p>These are the required imports for this example:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">iwopy</span> <span class="kn">import</span> <span class="n">Problem</span><span class="p">,</span> <span class="n">Objective</span><span class="p">,</span> <span class="n">Constraint</span>
<span class="kn">from</span> <span class="nn">iwopy.interfaces.pymoo</span> <span class="kn">import</span> <span class="n">Optimizer_pymoo</span>
</pre></div>
</div>
</div>
<p>We start by creating a specific class that describes the variables of our problem:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ChargesProblem</span><span class="p">(</span><span class="n">Problem</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy_init</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"charges_problem"</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xy_init</span> <span class="o">=</span> <span class="n">xy_init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xy_init</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>

    <span class="k">def</span> <span class="nf">var_names_float</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Defines the variable names"""</span>
        <span class="n">vnames</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">):</span>
            <span class="n">vnames</span> <span class="o">+=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"x</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">,</span> <span class="sa">f</span><span class="s2">"y</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">"</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">vnames</span>

    <span class="k">def</span> <span class="nf">initial_values_float</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Returns inital values, as given to constructor"""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">xy_init</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">min_values_float</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Minimal values for a square of size 2*radius"""</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">max_values_float</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Maximal values for a square of size 2*radius"""</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_individual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vars_int</span><span class="p">,</span> <span class="n">vars_float</span><span class="p">):</span>
        <span class="sd">"""Returns (x, y) variables for each charge"""</span>
        <span class="k">return</span> <span class="n">vars_float</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">apply_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vars_int</span><span class="p">,</span> <span class="n">vars_float</span><span class="p">):</span>
        <span class="sd">"""Returns (x, y) variables for each charge per individual"""</span>
        <span class="n">n_pop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vars_float</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">vars_float</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_pop</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_fig</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xy</span><span class="p">):</span>
        <span class="sd">"""Get a figure showing the charges locations"""</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xy</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">xy</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">"orange"</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">plt</span><span class="o">.</span><span class="n">Circle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">"darkred"</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">"equal"</span><span class="p">,</span> <span class="n">adjustable</span><span class="o">=</span><span class="s2">"box"</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">"x"</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">"y"</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">"N = </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span>
</pre></div>
</div>
</div>
<p>There are <span class="math notranslate nohighlight">\(2 N\)</span> variables for this problem, and we order them as <span class="math notranslate nohighlight">\((x_0, y_0, \ldots, x_{N-1}, y_{N-1})\)</span>. This is convenient, since the numpy reshaping operation <code class="docutils literal notranslate"><span class="pre">vars_float.reshape(n_charges,</span> <span class="pre">2)</span></code> then represents an array of <span class="math notranslate nohighlight">\((x_i, y_i)\)</span> type arrays, which is handy for calculations.</p>
<p>Notice the two functions <code class="docutils literal notranslate"><span class="pre">apply_individual</span></code> and <code class="docutils literal notranslate"><span class="pre">apply_population</span></code>. They are being called during optimization whenever new variables are being set by the optimizer, and their purpose is to update the data in the problem class accordingly (excluding objectives and constraints, which we will deal with shortly).</p>
<p>The difference between the two functions is that <code class="docutils literal notranslate"><span class="pre">apply_individual</span></code> evaluates a single vector of new problem variables, whereas <code class="docutils literal notranslate"><span class="pre">apply_population</span></code> handles a full population of such vectors. The implementation of the latter function is not strictly required (alternatively a loop over individuals of the population will be evaluated), but it provides a chance for a vast speed-up by vectorized evaluation. This is particularly beneficial for genetic algorithms or other easily vectorizable
approaches (in fact also the gradient calculation via <code class="docutils literal notranslate"><span class="pre">iwopy</span></code> discretizations makes use of this vectorization). Of course the chosen optimizer must be able to support vectorized evaluation for this to work. Both functions return any kind of evaluation data which will be forwarded to the objective and constraint evaluation.</p>
<p>So far we have only defined the problem variables. Objectives and constraints can be added to the problem via the <code class="docutils literal notranslate"><span class="pre">add_objective</span></code> and <code class="docutils literal notranslate"><span class="pre">add_constraint</span></code> functions, respectively. First, we implement the inverse distance potential as our objective:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MinPotential</span><span class="p">(</span><span class="n">Objective</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">problem</span><span class="p">):</span>
        <span class="sd">"""Define the same variable names and ordering as in the problem"""</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="s2">"potential"</span><span class="p">,</span> <span class="n">vnames_float</span><span class="o">=</span><span class="n">problem</span><span class="o">.</span><span class="n">var_names_float</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">n_charges</span>

    <span class="k">def</span> <span class="nf">n_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""The potential is a scalar function, hence one component"""</span>
        <span class="k">return</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">maximize</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Indicates that the single component is to be minimized"""</span>
        <span class="k">return</span> <span class="p">[</span><span class="kc">False</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">calc_individual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vars_int</span><span class="p">,</span> <span class="n">vars_float</span><span class="p">,</span> <span class="n">problem_results</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""This evaluates the potential. See problem.apply_individual</span>
<span class="sd">        for problem results"""</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">problem_results</span>
        <span class="n">value</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">):</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xy</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">xy</span><span class="p">[</span><span class="n">i</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="mf">1e-10</span><span class="p">)</span>
            <span class="n">value</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">dist</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">calc_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vars_int</span><span class="p">,</span> <span class="n">vars_float</span><span class="p">,</span> <span class="n">problem_results</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""This evaluates the potential in vectorized manner.</span>
<span class="sd">        See problem.apply_population for problem results"""</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">problem_results</span>
        <span class="n">n_pop</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n_pop</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">):</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xy</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">xy</span><span class="p">[:,</span> <span class="n">i</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">),</span> <span class="mf">1e-10</span><span class="p">)</span>
            <span class="n">value</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">dist</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">value</span>
</pre></div>
</div>
</div>
<p>Notice that the functions <code class="docutils literal notranslate"><span class="pre">calc_individual</span></code> and its (again optional) vectorized correspondent <code class="docutils literal notranslate"><span class="pre">calc_population</span></code> do not directly make use of the variables vector <code class="docutils literal notranslate"><span class="pre">vars_float</span></code>, which they could (and it would be perfectly fine, even intended), but instead of the <code class="docutils literal notranslate"><span class="pre">problem_results</span></code> provided by the problem functions <code class="docutils literal notranslate"><span class="pre">apply_individual</span></code> and <code class="docutils literal notranslate"><span class="pre">apply_population</span></code>.</p>
<p>Next, we implement the <span class="math notranslate nohighlight">\(N\)</span> radial constraints:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MaxRadius</span><span class="p">(</span><span class="n">Constraint</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">problem</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">):</span>
        <span class="sd">"""Define the same variable names and ordering as in the problem"""</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">problem</span><span class="p">,</span> <span class="s2">"radius"</span><span class="p">,</span> <span class="n">vnames_float</span><span class="o">=</span><span class="n">problem</span><span class="o">.</span><span class="n">var_names_float</span><span class="p">(),</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">n_charges</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">radius</span>

    <span class="k">def</span> <span class="nf">n_components</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""One constraint per charge"""</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span>

    <span class="k">def</span> <span class="nf">vardeps_float</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">"""Boolean array that defines which component depends</span>
<span class="sd">        on which variable (optional, default is on all)"""</span>
        <span class="n">deps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">deps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">fill_diagonal</span><span class="p">(</span><span class="n">deps</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">deps</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_components</span><span class="p">(),</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_charges</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">calc_individual</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vars_int</span><span class="p">,</span> <span class="n">vars_float</span><span class="p">,</span> <span class="n">problem_results</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""This evaluates the constraints, negative values are valid.</span>
<span class="sd">        See problem.apply_individual for problem results"""</span>
        <span class="n">components</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">s_</span><span class="p">[:]</span> <span class="k">if</span> <span class="n">components</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">components</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">problem_results</span><span class="p">[</span><span class="n">components</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span>

    <span class="k">def</span> <span class="nf">calc_population</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">vars_int</span><span class="p">,</span> <span class="n">vars_float</span><span class="p">,</span> <span class="n">problem_results</span><span class="p">,</span> <span class="n">components</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">"""This evaluates the constraints in vectorized manner,</span>
<span class="sd">        negative values are valid. See problem.apply_population for</span>
<span class="sd">        problem results"""</span>
        <span class="n">components</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">s_</span><span class="p">[:]</span> <span class="k">if</span> <span class="n">components</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">components</span>
        <span class="n">xy</span> <span class="o">=</span> <span class="n">problem_results</span><span class="p">[:,</span> <span class="n">components</span><span class="p">]</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">r</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span>
</pre></div>
</div>
</div>
<p>Note that by default, negative constraint values represent validity. This can be changed by overloading the function <code class="docutils literal notranslate"><span class="pre">get_bounds</span></code> of the base class, see API, but is not recommended.</p>
<p>Also note that the function <code class="docutils literal notranslate"><span class="pre">vardeps_float</span></code> is only relevant for gradient based solvers that support gradient sparsity (e.g. <code class="docutils literal notranslate"><span class="pre">pygmo.ipopt</span></code>). It is irrelevant for the genetic algorithm that we want to use in this example, but added for the sake of completeness.</p>
<p>Now let’s add the objective and the constraints and initialize the problem:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">R</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># generate random initial coordinates of the N charges:</span>
<span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">R</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">R</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">problem</span> <span class="o">=</span> <span class="n">ChargesProblem</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="n">MinPotential</span><span class="p">(</span><span class="n">problem</span><span class="p">))</span>
<span class="n">problem</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">MaxRadius</span><span class="p">(</span><span class="n">problem</span><span class="p">))</span>
<span class="n">problem</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_fig</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Problem 'charges_problem' (ChargesProblem): Initializing
--------------------------------------------------------
  n_vars_int   : 0
  n_vars_float : 40
--------------------------------------------------------
  n_objectives : 1
  n_obj_cmptns : 1
--------------------------------------------------------
  n_constraints: 1
  n_con_cmptns : 20
--------------------------------------------------------
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_examples_30_1.png" src="../_images/notebooks_examples_30_1.png">
</div>
</div>
<p>Finally, we can now setup the genetic solver <a class="reference external" href="https://pymoo.org/algorithms/soo/ga.html">GA from pymoo</a> and solve the problem, here in vectorized form (flag <code class="docutils literal notranslate"><span class="pre">vectorize=True</span></code>):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="n">solver</span> <span class="o">=</span> <span class="n">Optimizer_pymoo</span><span class="p">(</span>
    <span class="n">problem</span><span class="p">,</span>
    <span class="n">problem_pars</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">vectorize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">algo_pars</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">"ga"</span><span class="p">,</span>
        <span class="n">pop_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="p">),</span>
    <span class="n">setup_pars</span><span class="o">=</span><span class="nb">dict</span><span class="p">(),</span>
    <span class="n">term_pars</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="nb">type</span><span class="o">=</span><span class="s2">"default"</span><span class="p">,</span>
        <span class="n">n_max_gen</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="n">ftol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>
        <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-6</span><span class="p">,</span>
    <span class="p">),</span>
<span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
<span class="n">solver</span><span class="o">.</span><span class="n">print_info</span><span class="p">()</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Initializing Optimizer_pymoo
Selecting sampling: float_random (FloatRandomSampling)
Selecting algorithm: ga (GA)
Selecting termination: default (DefaultSingleObjectiveTermination)

Problem:
--------
  vectorize: True

Algorithm:
----------
  type: ga
  pop_size: 100

Termination:
------------
  n_max_gen: 300
  ftol: 1e-06
  xtol: 1e-06



Optimizer_pymoo: Optimization run finished
  Success: True
  Best potential = 78.18857190516454
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="n">xy</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">problem_results</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_fig</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Results problem 'charges_problem':
-----------------------------------
  Float variables:
    0: x0  = -3.925133e-01
    1: y0  = 4.984564e+00
    2: x1  = 2.009662e+00
    3: y1  = -1.038737e-01
    4: x2  = 4.998999e+00
    5: y2  = 9.778929e-02
    6: x3  = -4.118869e+00
    7: y3  = 2.830489e+00
    8: x4  = -4.833042e+00
    9: y4  = 1.280245e+00
    10: x5  = -2.121311e+00
    11: y5  = -4.526235e+00
    12: x6  = 4.712112e+00
    13: y6  = -1.668366e+00
    14: x7  = -4.581949e+00
    15: y7  = -1.999117e+00
    16: x8  = 2.969553e-01
    17: y8  = -4.990680e+00
    18: x9  = -2.411494e+00
    19: y9  = 4.378015e+00
    20: x10 = 2.229446e-01
    21: y10 = 2.613455e+00
    22: x11 = -1.853519e+00
    23: y11 = 3.172475e-01
    24: x12 = -1.617366e-01
    25: y12 = -2.637144e+00
    26: x13 = 3.843683e+00
    27: y13 = -3.191130e+00
    28: x14 = -4.984760e+00
    29: y14 = -3.824262e-01
    30: x15 = 2.512846e+00
    31: y15 = -4.320552e+00
    32: x16 = 3.377094e+00
    33: y16 = 3.686986e+00
    34: x17 = 4.649424e+00
    35: y17 = 1.838915e+00
    36: x18 = 1.897129e+00
    37: y18 = 4.626067e+00
    38: x19 = -3.721012e+00
    39: y19 = -3.338556e+00
-----------------------------------
  Objectives:
    0: potential = 7.818857e+01
-----------------------------------
  Constraints:
    0: radius_0  = -5.273076e-06
    1: radius_1  = -2.987656e+00
    2: radius_2  = -4.452101e-05
    3: radius_3  = -2.325494e-03
    4: radius_4  = -2.683414e-04
    5: radius_5  = -1.323643e-03
    6: radius_6  = -1.255340e-03
    7: radius_7  = -9.274631e-04
    8: radius_8  = -4.928508e-04
    9: radius_9  = -1.768378e-03
    10: radius_10 = -2.377052e+00
    11: radius_11 = -3.119527e+00
    12: radius_12 = -2.357901e+00
    13: radius_13 = -4.280803e-03
    14: radius_14 = -5.918043e-04
    15: radius_15 = -1.844332e-03
    16: radius_16 = -1.365413e-04
    17: radius_17 = -1.249597e-04
    18: radius_18 = -4.008799e-05
    19: radius_19 = -8.114325e-04
-----------------------------------
  Success: True
-----------------------------------

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_examples_33_1.png" src="../_images/notebooks_examples_33_1.png">
</div>
</div>
<p>Note that this problem has many equivalent solutions, and the displayed result is the best solution that the genetic algorithm was able to find within its convergence criteria. With heuristic methods there is generally no guarantee or proof that a global optimum has been found. However, the objective function has clearly been minimized, and therefore the “design” was improved which is often the goal in engineering tasks.</p>
<p>For the fun of it, let’s also solve the problem using iwopy’s <code class="docutils literal notranslate"><span class="pre">GG</span></code> solver (stands for <em>Greedy Gradient</em>), now for 50 charges. This solver is a simple steepest decent algorithm which projects out directions that would violate constraints (and reverts those that already do). It supports iwopy’s vectorization capabilities and hence can run fast for many variables. Of course it is not as advanced as other gradient based solvers, but for this particular problem it does a good job:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">iwopy.optimizers</span> <span class="kn">import</span> <span class="n">GG</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="n">N</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">R</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">xy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">R</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">,</span> <span class="n">R</span> <span class="o">/</span> <span class="mf">10.0</span><span class="p">,</span> <span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>

<span class="n">problem</span> <span class="o">=</span> <span class="n">ChargesProblem</span><span class="p">(</span><span class="n">xy</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
<span class="n">problem</span><span class="o">.</span><span class="n">add_objective</span><span class="p">(</span><span class="n">MinPotential</span><span class="p">(</span><span class="n">problem</span><span class="p">))</span>
<span class="n">problem</span><span class="o">.</span><span class="n">add_constraint</span><span class="p">(</span><span class="n">MaxRadius</span><span class="p">(</span><span class="n">problem</span><span class="p">))</span>

<span class="n">gproblem</span> <span class="o">=</span> <span class="n">LocalFD</span><span class="p">(</span><span class="n">problem</span><span class="p">,</span> <span class="n">deltas</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">,</span> <span class="n">fd_order</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">gproblem</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

<span class="n">solver</span> <span class="o">=</span> <span class="n">GG</span><span class="p">(</span>
    <span class="n">gproblem</span><span class="p">,</span>
    <span class="n">step_max</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">step_min</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span>
    <span class="n">vectorized</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">solver</span><span class="o">.</span><span class="n">finalize</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Problem 'charges_problem' (ChargesProblem): Initializing
--------------------------------------------------------
  n_vars_int   : 0
  n_vars_float : 100
--------------------------------------------------------
  n_objectives : 1
  n_obj_cmptns : 1
--------------------------------------------------------
  n_constraints: 1
  n_con_cmptns : 50
--------------------------------------------------------
Problem 'charges_problem_fd' (LocalFD): Initializing
----------------------------------------------------
  n_vars_int   : 0
  n_vars_float : 100
----------------------------------------------------
  n_objectives : 1
  n_obj_cmptns : 1
----------------------------------------------------
  n_constraints: 1
  n_con_cmptns : 50
----------------------------------------------------
GG: Optimization run finished
  Success: True
  Best potential = 587.9654163422571
Results problem 'charges_problem_fd':
--------------------------------------
  Float variables:
    0: x0  = -1.236208e+00
    1: y0  = -1.708999e+00
    2: x1  = 2.013002e+00
    3: y1  = -7.886082e-01
    4: x2  = 4.314693e+00
    5: y2  = 2.526550e+00
    6: x3  = -4.015066e+00
    7: y3  = 2.979854e+00
    8: x4  = 3.499176e+00
    9: y4  = 1.678460e+00
    10: x5  = -1.362974e+00
    11: y5  = 4.810645e+00
    12: x6  = -3.607953e+00
    13: y6  = 1.023309e+00
    14: x7  = -2.483641e+00
    15: y7  = -4.339552e+00
    16: x8  = 4.673964e+00
    17: y8  = -1.775998e+00
    18: x9  = 1.630472e+00
    19: y9  = -4.726692e+00
    20: x10 = -3.654452e+00
    21: y10 = -8.957545e-01
    22: x11 = 2.247764e+00
    23: y11 = 3.022091e+00
    24: x12 = -4.889755e+00
    25: y12 = -1.044440e+00
    26: x13 = -4.900226e-01
    27: y13 = -4.975941e+00
    28: x14 = 3.663091e+00
    29: y14 = 3.403210e+00
    30: x15 = 2.818225e+00
    31: y15 = 4.130087e+00
    32: x16 = 4.150963e+00
    33: y16 = -2.787393e+00
    34: x17 = -4.560103e+00
    35: y17 = -2.050762e+00
    36: x18 = -2.374185e+00
    37: y18 = 4.400368e+00
    38: x19 = 4.945479e+00
    39: y19 = -7.364235e-01
    40: x20 = -1.415240e+00
    41: y20 = 1.641640e+00
    42: x21 = -4.036053e+00
    43: y21 = -2.951396e+00
    44: x22 = -4.551125e+00
    45: y22 = 2.070613e+00
    46: x23 = 1.858505e+00
    47: y23 = 4.641763e+00
    48: x24 = 4.783005e+00
    49: y24 = 1.457018e+00
    50: x25 = 3.391337e+00
    51: y25 = -1.803648e+00
    52: x26 = -3.088196e-01
    53: y26 = 4.990453e+00
    54: x27 = 5.727371e-01
    55: y27 = -4.967097e+00
    56: x28 = -1.255281e+00
    57: y28 = -3.510220e+00
    58: x29 = -3.246922e+00
    59: y29 = 3.802313e+00
    60: x30 = 4.985018e+00
    61: y30 = 3.868391e-01
    62: x31 = 2.181194e+00
    63: y31 = -3.056698e+00
    64: x32 = -2.798771e+00
    65: y32 = 2.617715e+00
    66: x33 = 5.839424e-01
    67: y33 = 3.781091e+00
    68: x34 = 3.776890e+00
    69: y34 = -5.245396e-02
    70: x35 = 7.953584e-01
    71: y35 = 4.936334e+00
    72: x36 = 1.936926e+00
    73: y36 = 1.085468e+00
    74: x37 = -3.324688e+00
    75: y37 = -3.734501e+00
    76: x38 = -5.000000e+00
    77: y38 = 3.700560e-03
    78: x39 = -2.157369e+00
    79: y39 = -7.152338e-02
    80: x40 = 4.948472e-01
    81: y40 = -3.750252e+00
    82: x41 = 6.153006e-01
    83: y41 = -2.035853e+00
    84: x42 = 2.268677e-02
    85: y42 = 3.690313e-02
    86: x43 = 3.978828e-01
    87: y43 = 2.136130e+00
    88: x44 = -1.523031e+00
    89: y44 = -4.762399e+00
    90: x45 = 2.588252e+00
    91: y45 = -4.277966e+00
    92: x46 = -2.816180e+00
    93: y46 = -2.473878e+00
    94: x47 = 3.461650e+00
    95: y47 = -3.607915e+00
    96: x48 = -1.206654e+00
    97: y48 = 3.542324e+00
    98: x49 = -4.891478e+00
    99: y49 = 1.036359e+00
--------------------------------------
  Objectives:
    0: potential = 5.879654e+02
--------------------------------------
  Constraints:
    0: radius_0  = -2.890761e+00
    1: radius_1  = -2.838038e+00
    2: radius_2  = 3.491675e-06
    3: radius_3  = 2.794606e-05
    4: radius_4  = -1.119091e+00
    5: radius_5  = 6.028581e-07
    6: radius_6  = -1.249735e+00
    7: radius_7  = 1.837549e-05
    8: radius_8  = 1.050980e-05
    9: radius_9  = 5.701033e-06
    10: radius_10 = -1.237368e+00
    11: radius_11 = -1.233638e+00
    12: radius_12 = 5.596730e-05
    13: radius_13 = 1.078150e-05
    14: radius_14 = 7.145725e-06
    15: radius_15 = 7.171671e-07
    16: radius_16 = 5.429440e-06
    17: radius_17 = 1.651152e-05
    18: radius_18 = -5.045368e-07
    19: radius_19 = 7.923529e-06
    20: radius_20 = -2.832539e+00
    21: radius_21 = 4.630492e-05
    22: radius_22 = 1.812114e-05
    23: radius_23 = 5.300602e-07
    24: radius_24 = 4.062323e-06
    25: radius_25 = -1.158866e+00
    26: radius_26 = -1.239135e-06
    27: radius_27 = 7.767202e-06
    28: radius_28 = -1.272082e+00
    29: radius_29 = 8.179690e-06
    30: radius_30 = 4.949858e-06
    31: radius_31 = -1.244869e+00
    32: radius_32 = -1.167827e+00
    33: radius_33 = -1.174083e+00
    34: radius_34 = -1.222746e+00
    35: radius_35 = -1.631635e-06
    36: radius_36 = -2.779657e+00
    37: radius_37 = 4.848075e-06
    38: radius_38 = 1.369414e-06
    39: radius_39 = -2.841445e+00
    40: radius_40 = -1.217241e+00
    41: radius_41 = -2.873197e+00
    42: radius_42 = -4.956681e+00
    43: radius_43 = -2.827130e+00
    44: radius_44 = 6.913378e-06
    45: radius_45 = 4.616045e-06
    46: radius_46 = -1.251541e+00
    47: radius_47 = 6.784496e-06
    48: radius_48 = -1.257798e+00
    49: radius_49 = 5.933672e-05
--------------------------------------
  Success: True
--------------------------------------

</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate">
<div class="highlight"><pre><span></span>In [21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate">
<div class="highlight"><pre><span></span><span class="n">xy</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">problem_results</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">problem</span><span class="o">.</span><span class="n">get_fig</span><span class="p">(</span><span class="n">xy</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_examples_37_0.png" src="../_images/notebooks_examples_37_0.png">
</div>
</div>
</section>
</section>



           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../api.html" class="btn btn-neutral float-right" title="API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Fraunhofer IWES.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #009879;
    }
  </style>


</body>
</html>